<div class="where-to-find-table">
  <div class="row justify-content-between">
    <div class="col-sm-4">
      <%= tag.h2 t('catalog.show.find_it_header'), class: "section-title find-it-header" %>
    </div>
    <div class="col-sm-4 request-options">
      <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Request
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <% if document.hold_requestable?(current_or_guest_user) %>
          <%= link_to "Hold request", new_hold_request_path(hold_request: {mms_id: document.id, title: document['title_display_tesim']&.first}), class: "dropdown-item" %>
        <% end %>
        <% if current_or_guest_user&.doc_delivery? %>
          <%= link_to "Request Article or Chapter", '/#', class: "dropdown-item" %>
        <% end %>
      </div>
    </div>
  </div>

  <% if document.physical_holdings %>
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th scope="col" class="col-sm-4"><%= t('blacklight.availability.at_library') %></th>
            <th scope="col" class="col-sm-8"><%= t('blacklight.availability.status') %></th>
          </tr>
        </thead>
        <tbody>
          <% document.physical_holdings(current_or_guest_user).each.with_index(1) do |holding, index| %>
            <tr id="physical-holding-<%= index.to_s %>">
              <td>
                <%= holding[:library][:label] %>
                <br><%= holding[:location][:label] %>
                  <br><%= holding[:call_number] %>
                  </td>
                  <td>
                    <a href="#" class="toggle-table collapsed">
                      <% if holding[:availability][:availability_phrase] != "check_holdings" %>
                        <%= pluralize(holding[:availability][:copies], 'item') +
                      ", #{holding[:availability][:available]} available" +
                      ", " + pluralize(holding[:availability][:requests], 'request')
                  %>
                      <% else %>
                        Check holdings
                      <% end %>
                    </a>
                    <div class="table-responsive toggled-table" style="display: none;">
                      <table class="table table-sm">
                        <thead>
                          <tr>
                            <th scope="col" width="15%">barcode</th>
                            <th scope="col" width="10%">type</th>
                            <th scope="col" width="25%">policy</th>
                            <th scope="col" width="25%">description</th>
                            <th scope="col" width="25%">status</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% holding[:items_by_holding].each do |item| %>
                            <tr>
                              <td><%= item[:barcode] %></td>
                              <td><%= item[:type] %></td>
                              <% if current_or_guest_user.guest? %>
                                <td class="word-wrap"><%= item[:policy][:policy_desc] %></td>
                              <% else %>
                                <td class="word-wrap"><%= item[:policy][:due_date_policy] %></td>
                                <% end%>
                                <td class="word-wrap"><%= item[:description] %></td>
                                <td><%= item[:status] %></td>
                              </tr>
                            <% end %>

                          </tbody>
                        </table>
                      </div>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% end %>
        <% if document.online_holdings %>
          <table class="table">
            <thead>
              <tr>
                <th scope="col"><%= t('blacklight.availability.online') %></th>
                <th scope="col">&nbsp;</th>
              </tr>
            </thead>
            <tbody>
              <% document.online_holdings.each do |holding| %>
                <tr>
                  <td><%= t('blacklight.availability.access_online') %></td>
                  <td><%= link_to(holding[:label], holding[:url]) %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% end %>
        <!-- TODO: Change the link below to the production url for Alma if we continue to use this -->
        <%= link_to("Services page", "#{ENV["ALMA_BASE_SANDBOX_URL"]}/discovery/openurl?institution=#{ENV["INSTITUTION"]}&vid=#{ENV["INSTITUTION"]}:blacklight&rft.mms_id=#{document.id}") %>
      </div>
